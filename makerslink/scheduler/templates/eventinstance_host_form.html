{% extends "base_form.html" %}

{% block css %}
<style>
    .eventstatus-1:before{
        content: "Reschedule needed";
    }
    .eventstatus-1{
        color: #DD4444;
    }
    .eventstatus0:before{
        content: "Unscheduled";
    }
    .eventstatus0{
        color: blue;
    }
    .eventstatus1:before{
        content: "Scheduled";
    }
    .eventstatus1{
        color: green;
    }
    .eventstatus2:before{
        content: "Cancelled";
    }
    .eventstatus2{
        color: red;
    }
    tr.row-uneven{
        background: #EDEDED;
    }
    tr.row-even{
        background: #DCDCDC;
    }
    td, th{
        border: 1px solid #ddd;
        padding: 8px;
    }
    th{
        background: #4CAF50;
        color: white
    }
</style>
{% endblock %}

{% block content %}


{% for message in messages %}
    {% if 'safe' in message.tags %}
        {{ message|safe }}
    {% else %}
        { message }}
    {% endif %}
{% endfor %}

{% if taken_events %}
<b>The following events were not taken due to already being owned by someone else:</b></<br>
<table>
    <thead><tr>
        <th>Title</th>
        <th>Start</th>
        <th>End</th>
    </tr></thead>
    {% for event in taken_events %}
        <tr>
            <td>{{ event.title }}</td>
            <td>{{ event.start|date:"Y-m-d H:i" }}</td>
            <td>{{ event.end|date:"Y-m-d H:i" }}</td>
        </tr>
    {% endfor %}
</table><br><br>
{% endif %}

    <form method="post">
        {% csrf_token %}
        {{ formset.management_form }}
        {{ formset.non_form_errors.as_ul }}
        <table id="formset" class="form">
            <thead><tr>
                <th>Title</th>
                <th>Start</th>
                <th>End</th>
                <th>Status</th>
                <th>Take/Untake</th>
            </tr></thead>
            {% for form in formset.forms %}
                <tr class="{% cycle 'row-uneven' 'row-even' %}">
                    <td>{{ form.title.value }}</td>
                    <td>{{ form.initial.start|date:"Y-m-d H:i" }}</td>
                    <td>{{ form.initial.end|date:"Y-m-d H:i" }}</td>
                    <td class="eventstatus{{ form.initial.status }}"></td>
                    {% for field in form.visible_fields %}
                        <td>
                            {# Include the hidden fields in the form #}
                            {% if forloop.first %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endif %}
                            {{ field }}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
        <button type="submit" class="btn  btn-primary">Submit</button>
    </form>
{% endblock content %}
